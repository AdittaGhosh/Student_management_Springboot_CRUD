<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h2 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        .edit-btn {
            background-color: #007bff;
            margin-right: 5px;
        }
        .edit-btn:hover {
            background-color: #0056b3;
        }
        .delete-btn {
            background-color: #dc3545;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>Student Management System</h2>

    <!-- Form to Create/Update a Student -->
    <div class="form-group">
        <input type="hidden" id="studentId">
        <label for="name">Name:</label>
        <input type="text" id="name" placeholder="Enter student name">
    </div>
    <div class="form-group">
        <label for="dob">Date of Birth:</label>
        <input type="text" id="dob" placeholder="Enter DOB (e.g., 2000-01-01)">
    </div>
    <div class="form-group">
        <label for="fatherName">Father's Name:</label>
        <input type="text" id="fatherName" placeholder="Enter father's name">
    </div>
    <div class="form-group">
        <label for="motherName">Mother's Name:</label>
        <input type="text" id="motherName" placeholder="Enter mother's name">
    </div>
    <button onclick="saveOrUpdateStudent()">Save Student</button>

    <!-- Table to Display Students -->
    <table id="studentTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>DOB</th>
            <th>Father's Name</th>
            <th>Mother's Name</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="studentTableBody"></tbody>
    </table>
</div>

<script>
    const BASE_URL = "http://localhost:8080/studentService";

    // Fetch and display all students when the page loads
    window.onload = function() {
        fetchStudents();
    };

    // Fetch all students and display them in the table
    function fetchStudents() {
        fetch(`${BASE_URL}/getAllStudents`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById("studentTableBody");
                tableBody.innerHTML = ""; // Clear existing rows
                data.forEach(student => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                            <td>${student.id}</td>
                            <td>${student.name}</td>
                            <td>${student.DOB}</td>
                            <td>${student.fatherName}</td>
                            <td>${student.motherName}</td>
                            <td>
                                <button class="edit-btn" onclick="editStudent(${student.id})">Edit</button>
                                <button class="delete-btn" onclick="deleteStudent(${student.id})">Delete</button>
                            </td>
                        `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error("Error fetching students:", error));
    }

    // Save or Update a student
    function saveOrUpdateStudent() {
        const studentId = document.getElementById("studentId").value;
        const student = {
            id: studentId ? parseInt(studentId) : null,
            name: document.getElementById("name").value,
            DOB: document.getElementById("dob").value,
            fatherName: document.getElementById("fatherName").value,
            motherName: document.getElementById("motherName").value
        };

        const method = studentId ? "PUT" : "POST";
        const url = studentId ? `${BASE_URL}/updateStudent` : `${BASE_URL}/saveStudent`;

        fetch(url, {
            method: method,
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(student)
        })
            .then(response => response.json())
            .then(() => {
                fetchStudents(); // Refresh the table
                clearForm(); // Clear the form after saving
            })
            .catch(error => console.error("Error saving/updating student:", error));
    }

    // Edit a student (populate form with student data)
    function editStudent(id) {
        fetch(`${BASE_URL}/getStudent/${id}`)
            .then(response => response.json())
            .then(student => {
                document.getElementById("studentId").value = student.id;
                document.getElementById("name").value = student.name;
                document.getElementById("dob").value = student.DOB;
                document.getElementById("fatherName").value = student.fatherName;
                document.getElementById("motherName").value = student.motherName;
            })
            .catch(error => console.error("Error fetching student:", error));
    }

    // Delete a student
    function deleteStudent(id) {
        if (confirm("Are you sure you want to delete this student?")) {
            fetch(`${BASE_URL}/deleteStudentById/${id}`, {
                method: "DELETE"
            })
                .then(() => fetchStudents()) // Refresh the table
                .catch(error => console.error("Error deleting student:", error));
        }
    }

    // Clear the form after saving/updating
    function clearForm() {
        document.getElementById("studentId").value = "";
        document.getElementById("name").value = "";
        document.getElementById("dob").value = "";
        document.getElementById("fatherName").value = "";
        document.getElementById("motherName").value = "";
    }
</script>
</body>
</html>